> 学而不思则罔，思而不学则殆

# 1. 引子

Runloop是iOS开发的一个老生常谈的话题，网上的资料也是很多，但是我想了解的关键地方总是一笔带过，因此自己看源码，进行了资料补充，从头开始。

> 不再想以教程的方式来写总结了，真正的教程在各大知名网站上均有，日后博文将抽丝剥茧，关键的地方进行雕琢。

# 2. RunLoop

为什么需要RunLoop。

```c
void func1() {
  
}
void func() {
   func1();
}
int main() {
   func();
  return 0;
}
```

上面这个程序，在线程执行完main函数后，就结束了，什么也没了。但是手机APP不行，手机APP需要保活，在任何时候需要响应用户的操作以及系统的事件。让程序不结束的方案就是循环。此时Loop就出现了。

```c
do
{
}while(exit)
```

另外一个问题就是：不能一直空循环，因为空循环是对CPU的浪费。

走进源码了解RunLoop，NSRunLoop 是基于 CFRunLoopRef 的封装，提供了面向对象的 API，但是这些 API 不是线程安全的。我们可看CFRunLoop源码，这里不介绍整个CFRunLoop.h，CFRunLoop.c的源码，主要是关键的部分。

RunLoop不仅仅需要了解loop的部分，还需要有基础的铺垫，先将一些必须了解的数据结构先认识一下。